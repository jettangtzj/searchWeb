<html>
	<head>
		<meta charset="utf-8" />

		<link rel="stylesheet" type="text/css" href="my.css" />
		<script type="text/javascript" src="cookie.js"></script>
		<script src="layui/layui.all.js"></script>
		<link rel="stylesheet" type="text/css" href="layui/css/layui.css">
		<script type="text/javascript" src="jquery.js"></script>
		<style>
		</style>
		<style type="text/css">
			.content {
				width: 45%;
			}

			.title a {
				color: #1d42ee;
			}
		</style>
	</head>
	<body>
		<div style="float: left;padding-left: 10px;">
			<div style="float: left;width: 200px;margin-top: 15px;height: 50px;" onclick="changeURL">
				<a href="./index.html">
					<img style="width: 200px;height: 50px;" src="logo.png">
				</a>
			</div>

			<div class="hosts" style="width:80%;margin-top: -40px;float: left;margin-left: 200px;">

				<div id="out">
					<div id="ser_box">
						<input type="q" id="ipt" /><span><input id="su" value="搜索一下" class="bg s_btn" type="submit" onclick="searchkey()"></span>
					</div>

				</div>
				<br>
				<br>
				<div id="todo">
				</div>
				<div id="test1"></div>
			</div>
		</div>
	</body>

	<script type="text/javascript">
		function searchkey() {
			var key = $("#ipt").val();
			location.href = "result.html?q=" + key;
		}
		//回车触发点击事件
		$('#ipt').bind('keyup', function(event) {
			if (event.keyCode == "13") {
				searchkey();
			}
		})
		
		var q = getQueryString("q");
		q = q.q;
		var page = getQueryString("page");
		page = page.page;
		$("#ipt").val(q);
		if (page == "" || page == undefined) {
			page = "0";
		}
		api = "search?q=%E7%BE%8E%E5%A5%B3&page=1";
		var config = request(api);
		$.ajax({
			type: "get",
			// url: "test.json",
			url: "http://182.61.161.239/search",
			contentType: config.contentType,
			data: {
				q: q,
				page: page
			},
			success: function(res) {
				let arrSearch = res.content;
				var num = 0, nums;
				//去空格非空验证
				if(q.trim() == ""){
					$('#todo').html("请输入内容");
				}else{
					if(!arrSearch){
						$('#todo').html("该词暂无收录，请重新输入其他词进行搜索。。。");
					}else{
						for (let value of arrSearch) {
							let titleSearch = value.title;
							if (titleSearch.indexOf(q) != -1) {
								num++;
							}
						}
						//页码数
						if(num < 10 && num > 0){
							nums = page * 10;
						}else if(num === 0){
							alert("暂无您想要的" +q+"图片啦。。。")
							history.go(-1);
						}
						if (num) {
							//组成list
							var html = "";
							for (var i = 0; i < num; i++) {
								html += "<div id='list' style='height: 90px;'><p class='title' style='width: 440; overflow: hidden;white-space: nowrap;text-overflow: ellipsis;'><a target='_blank' href='" + arrSearch[i].url + "'>" + arrSearch[i].title +
									"</a></p><div class='content' style='width: 540; overflow: hidden; text-overflow: ellipsis; display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2;'>" + arrSearch[i].content + "</div></div><br />";
							}
							$('#todo').html(html);
							layui.use('laypage', function() {
								var laypage = layui.laypage;
								//执行一个laypage实例
								laypage.render({
									elem: 'test1' //注意，这里的 test1 是 ID，不用加 # 号
										,
									limit: 10,
									count: (nums < 100 ? nums : 100) //数据总数，从服务端得到
										,
									curr: page,
									jump: function(obj, first) {
										
										
										//首次不执行
										if (!first) {
											location.href = "result.html?q=" + q + "&page=" + obj.curr;
										}
									}
								})
							})
						}
					}
				}
			},
			error: function(responseText, textStatus, XMLHttpRequest) {
				console.log(error);
			}
		})
	</script>
</html>
